[workspace]
authors = [
    "Neclow <neil.clow@sund.ku.dk>",
    "Harrison Zhu <harrison.zhu@sund.ku.dk>",
    "David DuchÃªne <david.duchene@sund.ku.dk>",
]
channels = ["conda-forge", "bioconda"]
name = "phylaudio"
platforms = ["linux-64"]
version = "0.1.0"

[system-requirements]
cuda = "12.6"

[tasks]
post_install = "bash scripts/post_install.sh"
download_fleurs = "python -m pipeline.download_fleurs data/datasets"
download_glottolog = "python -m pipeline.download_glottolog fleurs-r"
download_phoible = "python -m pipeline.download_phoible fleurs-r"
download_models = "python -m pipeline.download_models data/models"
download_reference_trees = "python -m pipeline.download_reference_trees fleurs-r --preserve-branch-length"
beast_phylolm = "Rscript pipeline/beast_phylolm.R"
beast_generate_xml = "python -m pipeline.beast_generate_xml"
lid = "python -m pipeline.language_identification"
lid_summary = "python -m pipeline.language_identification_summary"
network_analysis = "python -m pipeline.network_analysis"
oak = "python -m pipeline.run_oak"
sentence_discrete = "python -m pipeline.sentence_trees_discrete"
sentence_distance = "python -m pipeline.sentence_trees_distance"
sentence_astral = "bash pipeline/sentence_trees_astral.sh"
sentence_summary = "python -m pipeline.sentence_trees_summary"
sentence_stats = "Rscript pipeline/sentence_trees_stats.R"

[tasks.beast2]
cmd = "extern/beast2/bin/beast"

[tasks.packagemanager]
cmd = "extern/beast2/bin/packagemanager"

[tasks.treeannotator]
cmd = "extern/beast2/bin/treeannotator"

[tasks.splitstree]
cmd = "extern/splitstree/SplitsTree"

[dependencies]
# Python deps
python = "3.10.12.*"
pandas = ">=2.3.2,<3"
requests = ">=2.32.5,<3"
tqdm = ">=4.67.1,<5"
pytorch = ">=2.7.1,<2.9"
torchaudio = ">=2.7.1,<2.9"
huggingface_hub = ">=0.34.4,<0.35"
lightning = ">=2.5.4,<3"
ete3 = ">=3.1.3,<4"
rpy2 = ">=3.6.2,<4"
scipy = ">=1.15.2,<2"
datasets = "==3.2.0"
transformers = "==4.45.2"
regex = ">=2025.7.34,<2026"
biopython = ">=1.85,<2"
torchinfo = ">=1.8.0,<2"
torchmetrics = ">=1.8.1,<2"
r-dplyr = ">=1.1.4,<2"
r-phangorn = ">=2.12.1,<3"
r-treedist = ">=2.11.1,<3"
r-base = ">=4.4.3,<4.5"
r-doparallel = ">=1.0.17,<2"
r-tidyr = ">=1.3.1,<2"
# Phylogenetics
iqtree = ">=3.0.1,<4"
aster = { version = ">=1.23,<2", channel = "bioconda" }
beagle-lib = { version = ">=4.0.1,<5", channel = "bioconda" }
# Dev tools
black = ">=25.1.0,<26"
uv = ">=0.8.13,<0.9"
pre-commit = ">=4.5.0,<5"

[pypi-dependencies]
pyglottolog = ">=3.16.0, <4"
nemo-toolkit = { version = ">=2.0.0, <3", extras = ["asr"] }
opensmile = ">=2.6.0, <3"
speechbrain = ">=1.0.3, <2"
openai-whisper = ">=20250625, <20250626"
torch-pca = ">=1.1.0, <2"
rapidfuzz = "==3.14.1"

[environments]
default = { solve-group = "default" }
oak = { features = ["oak"], solve-group = "oak" }
viz = { features = ["viz"], solve-group = "viz" }

[feature.oak.dependencies]
python = "3.10.12.*"
numpy = "<2.0"
ipykernel = ">7.0,<8"

[feature.oak.pypi-dependencies]
tensorflow = "==2.11.0"
tensorflow-probability = "==0.19.0"
gpflow = "==2.2.1"

[feature.oak.tasks]
beast_oak = "python -m pipeline.run_oak"

[feature.viz.dependencies]
python = "3.10.12.*"
plotly = ">=6.5.0,<7"
seaborn = ">=0.13.2,<0.14"

[feature.viz.tasks]
viz_acc_vs_brsupport = "python -m plots.acc_vs_brsupport"
viz_embeddings_pca = "python -m plots.embeddings_pca"
viz_beast_tree_heights = "python -m plots.beast_tree_heights"
# viz_phyloylm = "python -m plots.phylolm_effects"
# viz_sobol = "python -m plots.oak_sobol"
viz_phylolm = "python -m plots.phylolm_effects"
